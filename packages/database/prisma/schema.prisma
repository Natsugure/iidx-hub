// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Song {
  id          String   @id @default(uuid())
  title       String
  titleKana   String?  // かな表記
  genre       String
  artist      String
  bpm         String   // "150" or "150-180" など
  version     String   // 収録バージョン (e.g., "30 RESIDENT")
  
  charts      Chart[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([title])
  @@index([version])
}

model Chart {
  id                String   @id @default(uuid())
  songId            String
  song              Song     @relation(fields: [songId], references: [id], onDelete: Cascade)
  
  playStyle         String   // "SP" or "DP"
  difficulty        String   // "BEGINNER", "NORMAL", "HYPER", "ANOTHER", "LEGGENDARIA"
  level             Int      // 公式レベル (1-12)
  unofficialLevel   String?  // 非公式難易度 (e.g., "12.5")
  notes             Int?     // ノーツ数
  
  // 難易度表URL
  difficultyTableUrl String?
  
  // atwiki攻略ページURL
  wikiUrl           String?
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@unique([songId, playStyle, difficulty])
  @@index([playStyle, level])
  @@index([unofficialLevel])
}

// 難易度表の更新履歴
model DifficultyTableUpdate {
  id          String   @id @default(uuid())
  updatedAt   DateTime @default(now())
  success     Boolean
  message     String?
}
